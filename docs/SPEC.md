# PICO-8 IDE Extension — Specification

> Version 0.0.11 — 2026-02-09

## 1. Overview

PICO-8 IDE is a VS Code extension for browsing, viewing, editing, and running PICO-8 fantasy console games. It downloads game metadata from a remote database (or reads from a local FCDB distribution), displays games in a sidebar tree view, and provides a webview-based cartridge viewer with an integrated Monaco editor for inspecting and editing code, sprites, maps, SFX, and music.

## 2. Configuration Settings

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `pico8ide.dataMode` | `"remote" \| "local"` | `"remote"` | Source of game data |
| `pico8ide.remoteUrl` | `string` | GitHub release URL | URL to master database ZIP |
| `pico8ide.localPath` | `string` | `""` | Absolute path to local FCDB dist directory |
| `pico8ide.language` | `"" \| "en_US" \| "zh_CN"` | `""` | Display language override (empty = auto) |
| `pico8ide.pico8Path` | `string` | `""` | Absolute path to PICO-8 executable |

## 3. Commands

| Command ID | Title (EN) | Icon | Description |
|------------|-----------|------|-------------|
| `pico8ide.search` | Search | search.svg | Filter games by name or author |
| `pico8ide.refreshEntry` | Refresh | refresh.svg | Reload game database |
| `pico8ide.openCart` | Open Cartridge | — | Open cart viewer for a game |
| `pico8ide.selectGame` | *(internal)* | — | Select a game from the tree; opens cart viewer |
| `pico8ide.setPico8Path` | Set PICO-8 Path | — | Browse for PICO-8 executable; saves to global config |
| `pico8ide.runGame` | Run in PICO-8 | play.svg | Launch current game in local PICO-8 |
| `pico8ide.stopGame` | Stop PICO-8 | stop.svg | Kill the running PICO-8 process |
| `pico8ide.forkGame` | Fork Game | fork.svg | Copy a database game's cart into the workspace |
| `pico8ide.previewP8Cart` | Preview PICO-8 Cart | — | Open a `.p8` file in the cart viewer (context menu on `.p8` files in explorer) |

## 4. Keybindings

| Key | Command | When |
|-----|---------|------|
| `Ctrl+R` (`Cmd+R` on macOS) | `pico8ide.runGame` | `activeWebviewPanelId == pico8Cart \|\| resourceExtname == .p8` |

## 5. Menus

### `view/title` (pico8Lists)
- `pico8ide.search` — navigation group
- `pico8ide.refreshEntry` — navigation group

### `view/item/context` (pico8Lists, inline)
- `pico8ide.runGame` — when `viewItem == gameItem`
- `pico8ide.forkGame` — when `viewItem == gameItem`

### `explorer/context`
- `pico8ide.previewP8Cart` — when `resourceExtname == .p8`, navigation group

## 6. Tree View Behavior

### Game Selection (single click)
- Updates the detail sidebar webview with game metadata and thumbnail.
- Opens (or reuses) a **preview** cart viewer panel.

### Game Double-Click
- Detected by a second click on the same game item within 300 ms.
- **Pins** the current preview panel (promotes it to a persistent tab).

### Panel Activation Sync
- When a cart viewer panel tab becomes active (user clicks on a tab), the extension automatically updates `currentSelectedGame` and the detail sidebar to show that game's metadata.

### Tree Item Context
- `ListGameItem` sets `contextValue = 'gameItem'` so inline menu items can target game entries.

## 7. Cart Viewer Webview

### Shared HTML Generator (`cartViewerHtml.ts`)

All cart viewer webviews are generated by `generateCartViewerHtml()`, which accepts a `CartViewerOptions` object:

```typescript
interface CartViewerOptions {
    cartData: CartData;
    locale: LocaleStrings;
    extensionUri: vscode.Uri;
    webview: vscode.Webview;
    gameName?: string;
    showRunButton?: boolean;     // database game viewer only
    showConvertBanner?: boolean; // workspace .p8.png without companion .p8
    showAudio?: boolean;         // database game viewer only
    editable?: boolean;          // workspace .p8.png editor
}
```

Three callers use this shared generator:
1. **`Pico8CartPanel`** — database game viewer (read-only, with audio + run button)
2. **`Pico8PngEditorProvider`** — `.p8.png` custom editor (editable for workspace files)
3. **`previewP8Cart` command** — `.p8` file preview (read-only)

### Layout

The webview uses an edge-to-edge layout with no gaps:
- `body` has `margin: 0; padding: 0` (overrides VS Code's default `padding: 20px`)
- Tab header has no border separators between tabs or below the header
- Content areas have `padding: 0` — Monaco and other panels fill the entire available space
- `#monaco-container` has `overflow: hidden` so the editor scrollbar sits flush against the right edge

### Monaco Editor Integration

The Code tab uses Monaco Editor (AMD build) instead of a plain `<pre>` element.

**Loading**: Monaco's AMD loader (`loader.js`) is injected as a dynamic `<script>` element with the correct nonce. On load, it configures `require.config` and loads `vs/editor/editor.main`. Monaco workers use `data:` URL workaround for webview cross-origin restrictions.

**Language**: A custom `pico8-lua` Monarch tokenizer handles PICO-8 Lua syntax — keywords, builtins (print, cls, spr, etc.), comments (`--`, `--[[ ]]`), strings, numbers (decimal, hex `0x`, binary `0b`), and operators.

**Theme**: `pico8-dark` uses PICO-8-native colors:
| Token | Color |
|-------|-------|
| keyword | `#ff77a8` (pink) |
| builtin | `#29adff` (blue) |
| string | `#00e436` (green) |
| comment | `#5f574f` (brown, italic) |
| number | `#ffec27` (yellow) |
| operator | `#ff77a8` (pink) |
| identifier | `#c2c3c7` (light gray) |

Editor background: `#1a1a1a`. Cursor: `#ff77a8`.

**Read-only vs editable**: Controlled by the `editable` option. When editable, `onDidChangeModelContent` sends `{ type: 'codeChanged', code }` messages to the extension host.

### CSP (Content Security Policy)

```
default-src 'none';
script-src <cspSource> 'nonce-<nonce>' 'unsafe-eval';
style-src <cspSource> 'unsafe-inline';
font-src <cspSource>;
worker-src blob:;
img-src <cspSource>;
```

- `'unsafe-eval'` — required by Monaco's AMD loader (`new Function()`)
- `'unsafe-inline'` for `style-src` — Monaco injects CSS dynamically
- `blob:` for `worker-src` — Monaco web workers use blob URLs
- All inline `<script>` tags carry a nonce attribute
- **No inline event handlers** (`onclick`, etc.) — all click handlers are attached via `addEventListener` inside the nonce'd script block, because nonce-based CSP blocks inline HTML event attributes

### Tabs

- **Code** — Monaco editor with PICO-8 Lua syntax highlighting
- **Sprites** — 128×128 sprite sheet rendered to `<canvas>`; three-area layout: header bar (tools + palette + flags + zoom), canvas, status bar (see §7.4)
- **Map** — 128×64 tile map editor; three-area layout: header bar (tools + tile picker + zoom), dual canvas (tiles + overlay), status bar (see §7.6)
- **SFX** — split panel: left list of 64 SFX entries, right detail with note tracker; per-SFX playback (when audio enabled)
- **Music** — 64-pattern grid (8 columns); per-pattern playback (when audio enabled)

Tab switching calls `monacoEditor.layout()` when returning to the Code tab (Monaco does not auto-resize when its container is `display: none`).

### 7.4 Sprite Editor Layout

The sprite editor has three vertical areas:

1. **Header bar** (top, single row, wraps if narrow): Drawing tools (editable only) → separator → 16 color palette swatches (left-click = FG, right-click = BG) → FG/BG info label → separator → 8 flag filter buttons → 8 flag editor circles → separator → zoom controls. All elements share one `.sprite-toolbar` container.
2. **Canvas** (middle, flex-fills remaining space): 128×128 sprite sheet with grid/overlay.
3. **Status bar** (bottom, informational only, no interactive elements): Pixel coordinates, sprite number, current FG/BG color indices, active flags of hovered sprite as comma-separated list.

The separate palette row (`.sprite-palette`) is removed — its color swatches and flag circles are integrated into the header bar.

### 7.5 Sprite Flags

PICO-8 sprites have 8 flag bits per sprite (256 sprites × 1 byte = `gfxFlags[256]`). Flags are stored as a bitmask: bit 0 = flag 0, bit 7 = flag 7. Each flag is associated with a PICO-8 palette color (flags 0–7 → palette indices 8–15: red, orange, yellow, green, blue, lavender, pink, peach).

#### Flag Filter (toolbar)

Eight small colored buttons are displayed in the sprite toolbar between the drawing tools and the zoom controls. Each button corresponds to one flag (0–7) and is colored with the associated palette color. Buttons are off (dimmed) by default.

- **Toggle on**: Click a flag button to activate it. All 8×8 sprites whose bitmask includes that flag get a colored border overlay on the sprite sheet. The border color matches the flag's palette color.
- **Multiple flags**: Multiple flag filters can be active simultaneously. A sprite matching any active flag gets an overlay. If a sprite matches multiple active flags, the border uses the color of the lowest active flag.
- **Toggle off**: Click an active flag button again to deactivate it. The overlay updates immediately.
- The overlay is drawn in `seRenderOverlay()` after the grid lines but before the hover highlight.

#### Flag Editor (header bar)

Eight circular toggle buttons are displayed in the header bar, after the flag filter buttons. Each circle corresponds to one flag (0–7) and uses the associated flag color. They reflect the flags of the currently hovered sprite (the 8×8 cell under the mouse cursor).

- **Display**: When no sprite is hovered, all flag circles are dimmed/empty. When a sprite is hovered, filled circles indicate set flags.
- **Toggle (editable mode only)**: Clicking a flag circle toggles that bit in `FLAGS[spriteIndex]` and sends a `flagsChanged` message to the extension host.
- **Read-only mode**: Flag circles are displayed but not clickable.

#### Status Bar

The status bar is informational only (no interactive elements). It displays: pixel coordinates (`Pos: (x, y)`), sprite number (`Sprite: #n`), FG/BG color indices (`FG:n BG:n`), and the hovered sprite's flag bits as a comma-separated list (e.g. `Flags: 0,2,5`). Empty sections are omitted when the mouse is outside the canvas.

#### Message Protocol Addition

**Webview → Extension:**
- `{ type: 'flagsChanged', flags: number[] }` — the full 256-byte flags array, sent when any flag bit is toggled (debounced 100ms, same pattern as `gfxChanged`)

### 7.6 Map Editor Layout

The map editor mirrors the sprite editor's three-area layout and interaction model (§7.4), adapted for tile-based editing instead of pixel-based editing.

#### Data Model

- Map is 128 columns × 64 rows of tile indices (each 0–255, referencing a sprite).
- Upper 32 rows: stored in `MAP[ty * 128 + tx]` (4096 bytes at 0x2000–0x2FFF).
- Lower 32 rows: shared with sprite sheet lower half — `GFX[4096 + (ty - 32) * 128 + tx]`.
- Native canvas: 1024×512 pixels (128 tiles × 8px, 64 tiles × 8px).

#### Three-Area Layout

1. **Header bar** (top, single row, wraps if narrow): Drawing tools (editable only) → separator → tile picker (selected tile # + 8×8 sprite preview) → separator → zoom controls. All elements share one `.map-toolbar` container.
2. **Canvas** (middle, flex-fills remaining space): Dual canvas — `cvs-map` for tile rendering, `cvs-map-overlay` for grid/hover/selection overlays. Zoomable and pannable with the same interaction model as the sprite editor.
3. **Status bar** (bottom, informational only): Tile coordinates (`Tile: (tx, ty)`), sprite index at that position (`Sprite: #n`), flags of that sprite.

#### Coordinate System

All interactions use tile coordinates (0–127 × 0–63), not pixel coordinates. `meScreenToTile(clientX, clientY)` converts viewport position to `{tx, ty}` accounting for zoom and pan.

#### Tools (editable mode only)

| Tool | Key | Icon | Behavior |
|------|-----|------|----------|
| Pencil | D | ✎ | Left-click/drag: place selected tile. Right-click: pick tile from map (eyedropper). |
| Fill | F | ▧ | Flood-fill contiguous area of the same tile index with the selected tile. |
| Select | S | □ | Drag to create rectangular selection. Ctrl+C/X/V for copy/cut/paste. Drag selection to move. |
| Hand | P | ✋ | Click-drag to pan. Also activated by holding Space (temporary hand, same as sprite editor). |

#### Tile Picker

- **Header preview**: Shows `Tile: #n` with an inline 8×8 pixel canvas rendering the selected sprite. Updated whenever the selected tile changes.
- **Right-click (eyedropper)**: Right-clicking the map with the pencil tool picks the tile at that position, updating the selected tile.
- **Q / W keys**: Select previous / next sprite index (wraps 0–255).
- **X key or click on header preview**: Opens a popup tile picker — a 16×16 grid (128×128 canvas) showing all 256 sprites. Click a sprite to select it as the current tile. Click outside or press Escape to dismiss.

#### Zoom, Pan, and Overlays

Same model as sprite editor (§7.4):
- **Zoom**: Mouse wheel (normalized, same sensitivity as sprite editor). +/− keys. 0 key to fit.
- **Pan**: Hand tool, Space+drag, middle-mouse drag.
- **Tile grid overlay**: Drawn at zoom ≥ 1 (every 8px = 1 tile). Dimmed gray lines.
- **Hover highlight**: Outlines the tile under the cursor.
- **Selection**: Marching ants rectangle (same as sprite editor).
- `meRenderOverlay()` handles all overlay drawing.

#### Undo / Redo

- `Ctrl+Z` / `Ctrl+Shift+Z` (or `Ctrl+Y`): Undo / redo.
- Undo stack stores snapshots of `MAP` (4096 bytes). For lower-row edits, also stores the affected GFX range.
- Max 50 undo levels (same as sprite editor).

#### Change Notification

- `notifyMapChanged()`: Debounced 100ms. Sends `{ type: 'mapChanged', map: MAP.slice() }` to the extension host.
- Lower 32-row edits additionally trigger `notifyGfxChanged()` (existing message) since they modify shared GFX memory.

#### Initialization

`initMapEditor()` is called when the Map tab is first activated (lazy init, same pattern as sprite editor's `initSpriteEditor()`). It sets up the dual canvas, fits to container, attaches event listeners, and calls `meRenderCanvas()`.

### Cart Viewer Panel (`Pico8CartPanel`)

ViewType: `pico8Cart`. Opens as an editor-area webview panel for database games.

#### Preview / Pin Model

Cart panels follow a preview/pin model inspired by VS Code's file preview behavior:

- **Preview panel**: Opened on single-click. Only one preview panel exists at a time. Its tab title is prefixed with `*` (e.g. `*Cart: Celeste`) to indicate transient status. Opening a different game replaces the current preview panel.
- **Pinned panel**: Created when the user double-clicks a game, or when the preview panel is promoted. The `*` prefix is removed from the title. Pinned panels persist — opening another game does not close them. Multiple pinned panels can coexist.

#### Internal Tracking

- `Pico8CartPanel._previewPanel` — the single replaceable preview panel (or `undefined`).
- `Pico8CartPanel._pinnedPanels` — a `Map<string, Pico8CartPanel>` keyed by game ID.
- `Pico8CartPanel.currentGame` — returns the game of the most recently focused panel (preview or pinned).
- When a preview panel is pinned, it is moved from `_previewPanel` to `_pinnedPanels` and the title `*` prefix is removed.
- Each panel's `onDidDispose` removes itself from the tracking structures.

#### Run / Stop Button

A run/stop button is displayed in the top-right area of the cart viewer header (only for database game viewers via `showRunButton: true`).

- **Idle state**: Shows ▶ Run in PICO-8. Clicking sends a `run` message.
- **Running state**: Shows ⏹ Stop PICO-8. Clicking sends a `stop` message.
- The extension host pushes `{ type: 'runState', running: boolean }` to keep the button in sync.

### Message Protocol (webview ↔ extension)

**Webview → Extension:**
- `{ type: 'run' }` — request to launch PICO-8 with the current cart
- `{ type: 'stop' }` — request to kill the running PICO-8 process
- `{ type: 'codeChanged', code: string }` — Monaco editor content changed (editable mode only)
- `{ type: 'gfxChanged', gfx: number[] }` — sprite pixel data changed (editable mode only)
- `{ type: 'mapChanged', map: number[] }` — map tile data changed (editable mode only, debounced 100ms)
- `{ type: 'flagsChanged', flags: number[] }` — sprite flags changed (editable mode only, debounced 100ms)
- `{ type: 'convert' }` — user clicked the convert-to-`.p8` banner button

**Extension → Webview:**
- `{ type: 'runState', running: boolean }` — update the run/stop button state

## 8. `.p8.png` Custom Editor (`Pico8PngEditorProvider`)

ViewType: `pico8ide.pngViewer`. Registered as a `CustomEditorProvider<Pico8PngDocument>` for `*.p8.png` files.

### Document Model

```typescript
interface Pico8PngDocument extends CustomDocument {
    uri: vscode.Uri;
    cartData: CartData | null;
    currentCode: string | null;  // edited code from Monaco, null if unchanged
}
```

### Three Modes

1. **Database cart** (file inside `globalStorageUri`): Read-only viewer, no banner, no audio.
2. **Workspace file with companion `.p8`**: Shows a prompt to open the `.p8` file instead. Does not render the cart viewer.
3. **Workspace file without companion `.p8`**: Editable viewer with convert banner. Monaco editor is editable; code changes are tracked via `codeChanged` messages.

### Save Behavior

- **Save** (`Cmd+S`): Writes a companion `.p8` file alongside the `.p8.png` (cannot re-encode steganographic PNG). Uses `cartDataToP8()` from `p8format.ts`.
- **Save As**: Writes to the chosen destination as `.p8` format.
- **Revert**: Re-decodes the `.p8.png` file, resets `currentCode` to null.
- **Backup**: Writes `.p8` format to the backup destination for VS Code's hot exit.

### Convert Banner

When `showConvertBanner` is true, a yellow banner appears above the tabs with a button to extract the cart as a `.p8` file. On click, the extension writes the `.p8` file and opens it in the text editor.

## 9. `.p8` File Preview

The `pico8ide.previewP8Cart` command (available via right-click context menu on `.p8` files in the explorer) opens a read-only cart viewer in a webview panel. It parses `.p8` text format, extracts sections (code, gfx, map, sfx, music), and passes the data to `generateCartViewerHtml()` with no audio, no run button, and not editable.

## 10. PICO-8 Process Management

### Launching
- `pico8ide.runGame` resolves the game from: (1) `ListGameItem` argument (context menu), (2) `currentSelectedGame`, or (3) `Pico8CartPanel.currentGame`.
- Checks `pico8ide.pico8Path`; if empty, prompts user via warning message to set it.
- Verifies the executable exists on disk.
- Downloads the cart via `dataManager.getAssetPath(game, 'cart')`.
- Spawns PICO-8 with `-run <cartPath>` (detached, stdio ignored).
- Stores the `ChildProcess` reference for stop support.
- Pushes `runState: true` to the cart webview.

### Stopping
- `pico8ide.stopGame` (or webview stop button) kills the tracked child process.
- Pushes `runState: false` to the cart webview.
- The process `exit` event also triggers `runState: false`.

### macOS `.app` Resolution
When the user selects a `.app` bundle via `setPico8Path`, the extension auto-resolves to `<bundle>/Contents/MacOS/pico8`.

## 11. Cartridge Decoding (`pngDecoder.ts`)

`Pico8Decoder.decode()` reads a `.p8.png` file and extracts:
- **RAM** (32 KB): Reconstructed from steganographic 2-bit channels (A, R, G, B low bits)
- **Label**: 128×128 pixel region extracted at offset (16, 24) from the source PNG, returned as a `data:image/png;base64,...` URL
- **Sections** sliced from RAM: GFX (0x0000–0x1FFF), MAP (0x2000–0x2FFF), GFX Flags (0x3000–0x30FF), Music (0x3100–0x31FF), SFX (0x3200–0x42FF)
- **Code** starting at 0x4300, decoded by format:
  - Raw: null-terminated ASCII
  - `:c:\0` (legacy LZSS): 8-byte header (magic + 2-byte big-endian codelen + 2 zero bytes), then LZSS-compressed data with LUT dictionary
  - `\0pxa` (PXA): bit-packed MTF + LZ compression

## 12. Localization

### NLS Keys (package.nls)
| Key | EN | ZH-CN |
|-----|-----|-------|
| `command.setPico8Path.title` | Set PICO-8 Path | 设置 PICO-8 路径 |
| `command.runGame.title` | Run in PICO-8 | 在 PICO-8 中运行 |
| `command.stopGame.title` | Stop PICO-8 | 停止 PICO-8 |
| `config.pico8Path.description` | Absolute path to the PICO-8 executable... | PICO-8 可执行文件的绝对路径... |

### Runtime Locale Keys (i18n.ts)
| Key | EN | ZH-CN |
|-----|-----|-------|
| `pico8PathNotSet` | PICO-8 path is not set. Would you like to set it now? | 未设置 PICO-8 路径。是否现在设置？ |
| `pico8PathNotFound` | PICO-8 executable not found at the configured path. | 在配置的路径中未找到 PICO-8 可执行文件。 |
| `pico8PathSelectPrompt` | Select PICO-8 executable | 选择 PICO-8 可执行文件 |
| `runGameFailed` | Failed to launch PICO-8 | 启动 PICO-8 失败 |
| `stopGame` | Stop PICO-8 | 停止 PICO-8 |
| `runInPico8` | Run in PICO-8 | 在 PICO-8 中运行 |

## 13. Dependencies

| Package | Purpose |
|---------|---------|
| `monaco-editor` (^0.52.0) | Code editor in webview tabs |
| `pngjs` (^7.0.0) | PNG decode/encode for `.p8.png` steganography |
| `adm-zip` (^0.5.10) | Unzip remote database downloads |

Monaco's AMD build (`min/vs/`) is copied to `resources/monaco/` by `scripts/copy-monaco.js` (runs on `postinstall` and `precompile`). The `.gitignore` excludes `resources/monaco/`; `.vscodeignore` ensures it is included in the VSIX package.

## 14. Icon Assets

| Path | Fill | Purpose |
|------|------|---------|
| `resources/dark/play.svg` | `#C5C5C5` | Play/run icon (dark theme) |
| `resources/light/play.svg` | `#424242` | Play/run icon (light theme) |
| `resources/dark/stop.svg` | `#C5C5C5` | Stop icon (dark theme) |
| `resources/light/stop.svg` | `#424242` | Stop icon (light theme) |
| `resources/dark/fork.svg` | `#C5C5C5` | Fork icon (dark theme) |
| `resources/light/fork.svg` | `#424242` | Fork icon (light theme) |

All icons use 16×16 viewBox SVG format.

---

## Changelog

### 0.0.11 — 2026-02-09
- Added interactive map editor (§7.6) replacing the static read-only map canvas.
- Map editor uses same three-area layout as sprite editor: header bar (tools + tile picker + zoom), dual canvas, status bar.
- Tools: pencil (draw/pick), fill (flood fill), select (rect, copy/cut/paste), hand (pan).
- Tile picker with header preview, right-click eyedropper, Q/W next/prev, X key popup grid.
- Zoom, pan, overlays (tile grid, hover, selection) mirroring sprite editor interaction model.
- Undo/redo for map edits (MAP snapshots + shared GFX range for lower rows).
- Added `mapChanged` webview→extension message for map editing persistence.

### 0.0.10 — 2026-02-09
- Merged sprite toolbar and palette into a single header bar: drawing tools + color swatches + flag filter + flag editor circles + zoom controls in one row.
- Removed the separate palette row (`.sprite-palette`); palette elements now in header bar.
- Status bar is now purely informational: pixel coords, sprite #, FG/BG colors, active flags. No interactive elements.
- Added §7.4 Sprite Editor Layout section; renumbered Sprite Flags to §7.5.

### 0.0.9 — 2026-02-09
- Added sprite flag filter overlay: 8 colored toggle buttons in sprite toolbar highlight all sprites with a given flag on the sprite sheet.
- Added per-sprite flag editor: 8 flag circles in the palette area show/toggle flags for the hovered sprite.
- Status bar now shows active flag bits for the hovered sprite.
- Added `flagsChanged` webview→extension message for flag editing persistence.
- Documented sprite flags system in §7.4.

### 0.0.8 — 2026-02-08
- Replaced `<pre>` code display with Monaco Editor in all cart viewer webviews.
- Created shared `cartViewerHtml.ts` module (`generateCartViewerHtml`) replacing three duplicated HTML generators.
- PICO-8 Lua Monarch tokenizer and `pico8-dark` theme with native PICO-8 color palette.
- Edge-to-edge layout: removed body padding, tab gaps, and content padding; Monaco fills entire code area.
- All inline `onclick` handlers replaced with `addEventListener` to comply with nonce-based CSP.
- Upgraded `Pico8PngEditorProvider` from `CustomReadonlyEditorProvider` to `CustomEditorProvider` with save/revert/backup support.
- Editable Monaco editor for workspace `.p8.png` files; save writes companion `.p8` file.
- Added `pico8ide.forkGame` command to copy database carts into workspace.
- Added `pico8ide.previewP8Cart` command for `.p8` file preview via explorer context menu.
- Removed `pico8ide.runGame` from `view/title` menu (kept in `view/item/context` inline only).
- Fixed `:c:` LZSS decompression: corrected 8-byte header parsing (was skipping only 4 bytes, producing `???` characters).
- Added `monaco-editor` dependency with `postinstall`/`precompile` copy script.
- Added `.vscodeignore` to exclude source from VSIX but include `resources/monaco/`.

### 0.0.7 — 2026-02-08
- Cart viewer now uses preview/pin model: single-click opens a preview panel (tab prefixed with `*`), double-click pins it (removes `*`, persists across subsequent opens). Multiple pinned panels can coexist.

### 0.0.6 — 2026-02-08
- Added `pico8ide.pico8Path` setting for local PICO-8 executable path.
- Added `pico8ide.setPico8Path` command with macOS `.app` bundle auto-resolution.
- Added `pico8ide.runGame` command with play icon in tree view title and inline on game items.
- Added `pico8ide.stopGame` command to kill a running PICO-8 process.
- Added `Ctrl+R` / `Cmd+R` keybinding to run game when cart viewer is active.
- Game selection now auto-runs the game in PICO-8 on double-click (single click opens cart viewer only).
- Cart viewer webview now shows a Run/Stop toggle button with bidirectional message passing.
- Added play and stop SVG icons for dark and light themes.
- Added runtime locale keys for run/stop strings in English and Chinese.
